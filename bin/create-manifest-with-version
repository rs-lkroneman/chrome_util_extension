#!/usr/bin/env node

const path = require('path');
const fsExtra = require('fs-extra');
const manifest = require("../config/manifest.json");

const date = new Date();
const year = date.getFullYear();
const month = date.getMonth() + 1 //months (0-11)
const day = date.getDate();//day (1-31)
const hour = date.getHours();
const minute = date.getMinutes();

const OUTPUT_PATH = path.resolve('public');
const RELEASE_VERSION = process.env.RELEASE_VERSION;

// For development the version updates each time you start the server to be the minute it started 202218.23.32
const EXTENSION_VERSION = RELEASE_VERSION || `${year}${month}${day}.${hour}.${minute}`;
const updatedManifest = {
    ...manifest,
    version: `${EXTENSION_VERSION.replace('v',  '')}`
};

fsExtra.writeJson(path.join(OUTPUT_PATH, 'manifest.json'), updatedManifest)
    .catch(console.error);
